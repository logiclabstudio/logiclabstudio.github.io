<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b1020" />
  <title>CV Generator | Guidance Template</title>
  <style>
    :root{
      --bg:#0b1020;
      --bg2:#0f172a;
      --card: rgba(255,255,255,.06);
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line: rgba(255,255,255,.12);
      --accent:#60a5fa;
      --accent2:#22c55e;
      --danger:#fb7185;
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --r:16px;
      --max: 1200px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      background: radial-gradient(1200px 600px at 20% -10%, rgba(96,165,250,.25), transparent 60%),
                  radial-gradient(1000px 600px at 90% 0%, rgba(34,197,94,.18), transparent 55%),
                  linear-gradient(180deg, var(--bg), #070a12 70%);
      color: var(--text);
    }
    a{color:inherit}
    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 18px 16px 26px;
    }
    header{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
      margin-bottom: 14px;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .logo{
      width:44px; height:44px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(96,165,250,.9), rgba(34,197,94,.7));
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
    }
    h1{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .sub{
      margin:2px 0 0;
      color: var(--muted);
      font-size: 12px;
    }
    .top-actions{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 650;
      font-size: 12px;
      letter-spacing:.2px;
      cursor:pointer;
      user-select:none;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{border-color: rgba(96,165,250,.55)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(96,165,250,.95), rgba(96,165,250,.55));
      border-color: rgba(96,165,250,.5);
      color: #07101f;
    }
    .btn.ok{
      background: linear-gradient(135deg, rgba(34,197,94,.95), rgba(34,197,94,.55));
      border-color: rgba(34,197,94,.45);
      color: #06160e;
    }
    .btn.danger{
      background: rgba(251,113,133,.10);
      border-color: rgba(251,113,133,.35);
    }
    .pill{
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      color: var(--muted);
      background: rgba(255,255,255,.03);
      display:inline-flex; gap:8px; align-items:center;
      white-space:nowrap;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr; }
      header{flex-direction:column; align-items:stretch;}
      .top-actions{justify-content:flex-start}
    }
    .panel{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel .hd{
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background: rgba(0,0,0,.18);
    }
    .panel .hd strong{font-size: 13px}
    .panel .bd{padding: 12px 14px;}
    .section{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding: 12px;
      margin-bottom: 12px;
    }
    .section:last-child{margin-bottom:0}
    .section-title{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom: 10px;
    }
    .section-title b{font-size: 12px; letter-spacing:.25px}
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .row.one{grid-template-columns:1fr}
    label{
      display:block;
      font-size: 11px;
      color: var(--muted);
      margin: 0 0 6px;
    }
    input, textarea, select{
      width:100%;
      padding: 10px 11px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      font-size: 13px;
    }
    textarea{min-height: 92px; resize: vertical}
    input:focus, textarea:focus, select:focus{
      border-color: rgba(96,165,250,.6);
      box-shadow: 0 0 0 4px rgba(96,165,250,.12);
    }
    .mini{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top: 10px;
    }
    .hint{
      font-size: 11px;
      color: var(--muted);
      margin-top: 8px;
      line-height: 1.35;
    }
    .split{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .scoreCard{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 12px;
      padding: 10px;
    }
    .scoreHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      margin-bottom:8px;
      font-size:12px;
    }
    .scoreHead b{font-size:12px;}
    .scoreTrack{
      width:100%;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
    }
    .scoreFill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, #fb7185 0%, #f59e0b 45%, #22c55e 100%);
      transition: width .2s ease;
    }
    .suggestions{
      margin: 10px 0 0;
      padding-left: 16px;
      font-size: 12px;
      color: var(--text);
      line-height: 1.45;
    }
    .suggestions li{margin-bottom:6px;}
    .suggestions li:last-child{margin-bottom:0;}

    /* ===== Preview (Screen) ===== */
    .previewWrap{
      padding: 14px;
    }
    .cv{
      background: #ffffff;
      color: #0b1220;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.10);
    }
    .cvInner{
      padding: 28px 28px 22px;
      font-family: var(--sans);
    }
    .cvTop{
      display:flex; justify-content:space-between; gap:18px; align-items:flex-start;
      border-bottom: 1px solid rgba(15,23,42,.12);
      padding-bottom: 14px;
      margin-bottom: 14px;
    }
    .name{
      font-size: 28px;
      font-weight: 820;
      letter-spacing: .2px;
      margin: 0;
      line-height: 1.1;
    }
    .role{
      margin: 6px 0 0;
      font-size: 13.5px;
      color: rgba(15,23,42,.75);
      font-weight: 650;
    }
    .contact{
      text-align:right;
      font-size: 11.5px;
      color: rgba(15,23,42,.78);
      line-height: 1.55;
      min-width: 210px;
    }
    .contact a{color: inherit; text-decoration: none;}
    .twoCol{
      display:grid;
      grid-template-columns: 1fr 0.62fr;
      gap: 18px;
    }
    .cv h3{
      margin: 0 0 6px;
      font-size: 12px;
      letter-spacing: .26px;
      text-transform: uppercase;
      color: rgba(15,23,42,.85);
    }
    .summary{
      font-size: 12.5px;
      color: rgba(15,23,42,.86);
      line-height: 1.55;
      margin-bottom: 14px;
      white-space: pre-wrap;
    }
    .item{
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(15,23,42,.10);
    }
    .item:last-child{border-bottom:none; padding-bottom:0; margin-bottom:0}
    .itemTop{
      display:flex; justify-content:space-between; gap:12px; align-items:baseline;
    }
    .itemTitle{
      font-weight: 780;
      font-size: 13px;
      margin: 0;
      color: rgba(15,23,42,.95);
    }
    .itemMeta{
      font-size: 11px;
      color: rgba(15,23,42,.70);
      white-space:nowrap;
    }
    .itemSub{
      margin: 3px 0 0;
      font-size: 12px;
      color: rgba(15,23,42,.82);
      font-weight: 650;
    }
    .bullets{
      margin: 6px 0 0;
      padding-left: 16px;
      color: rgba(15,23,42,.86);
      font-size: 12.2px;
      line-height: 1.5;
    }
    .tagList{
      display:flex; flex-wrap:wrap; gap:6px;
    }
    .tag{
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      background: rgba(96,165,250,.12);
      border: 1px solid rgba(96,165,250,.25);
    }
    .smallBox{
      margin-bottom: 12px;
    }
    .smallText{
      font-size: 12.2px;
      color: rgba(15,23,42,.86);
      line-height: 1.45;
      white-space: pre-wrap;
    }

    /* ===== Print / PDF ===== */
    @page{
      size: A4;
      margin: 10mm;
    }
    @media print{
      html, body{
        background:#fff !important;
      }
      body{
        margin:0 !important;
      }
      .wrap{
        max-width:none;
        margin:0;
        padding:0;
      }
      header, .panel.left, .top-actions, .pill, .hint, .mini {display:none !important;}
      .grid{display:block !important}
      .panel.right{
        border:none;
        box-shadow:none;
        background:transparent;
        overflow:visible;
      }
      .panel.right .hd{display:none !important}
      .previewWrap{padding:0}
      .cv{
        border:none;
        border-radius:0;
        box-shadow:none;
      }
      .cvInner{padding: 12mm 10mm 10mm}
      .twoCol{grid-template-columns: 1fr 0.65fr;}
      a{text-decoration:none}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>CV Generator</h1>
          <div class="sub">Fill in the form ‚Üí preview updates live ‚Üí export via Print to PDF</div>
        </div>
      </div>
      <div class="top-actions">
        <button class="btn primary" id="btnPrint">üñ®Ô∏è Print / Save as PDF</button>
        <button class="btn ok" id="btnSave">üíæ Save JSON</button>
        <label class="btn" style="cursor:pointer">
          ‚¨ÜÔ∏è Load JSON
          <input id="fileLoad" type="file" accept="application/json" style="display:none">
        </label>
        <button class="btn danger" id="btnReset">üß® Reset</button>
        <span class="pill">Offline ‚Ä¢ Single file ‚Ä¢ No libraries</span>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: FORM -->
      <div class="panel left">
        <div class="hd">
          <strong>Details</strong>
          <div class="split">
            <span class="pill">Tip: Use lines for bullets (‚Ä¢ / -)</span>
          </div>
        </div>
        <div class="bd">

          <div class="section">
            <div class="section-title">
              <b>Profile</b>
              <span class="pill">Top of CV</span>
            </div>
            <div class="row">
              <div>
                <label>Full name</label>
                <input id="fullName" placeholder="e.g. Your Full Name" />
              </div>
              <div>
                <label>Headline / Role</label>
                <input id="headline" placeholder="e.g. Your Target Role" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Phone</label>
                <input id="phone" placeholder="e.g. 062 388 1570" />
              </div>
              <div>
                <label>Email</label>
                <input id="email" placeholder="e.g. name@email.com" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Website / Portfolio</label>
                <input id="website" placeholder="e.g. yourportfolio.com" />
              </div>
              <div>
                <label>Location</label>
                <input id="location" placeholder="e.g. City, Country" />
              </div>
            </div>
            <div class="row one">
              <div>
                <label>Professional summary</label>
                <textarea id="summary" placeholder="2‚Äì5 lines: what you do + what you‚Äôre strong at + what you want."></textarea>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-title">
              <b>Skills</b>
              <span class="pill">Comma separated</span>
            </div>
            <div class="row one">
              <div>
                <label>Skills (comma separated)</label>
                <textarea id="skills" placeholder="HTML, CSS, JavaScript, C#, .NET, SQL, Git, APIs, ..."></textarea>
              </div>
            </div>
            <div class="hint">These appear as tags on the right column.</div>
          </div>

          <div class="section">
            <div class="section-title">
              <b>Experience</b>
              <span class="pill">Max 4 items</span>
            </div>

            <!-- Experience items -->
            <div class="row">
              <div>
                <label>Role (1)</label>
                <input id="exp_role_1" placeholder="e.g. Software Developer" />
              </div>
              <div>
                <label>Company (1)</label>
                <input id="exp_company_1" placeholder="e.g. Company Name" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Dates (1)</label>
                <input id="exp_dates_1" placeholder="e.g. 2025 ‚Äì Present" />
              </div>
              <div>
                <label>Location (1)</label>
                <input id="exp_loc_1" placeholder="e.g. Remote" />
              </div>
            </div>
            <div class="row one">
              <div>
                <label>Highlights (1) ‚Äî one per line</label>
                <textarea id="exp_points_1" placeholder="Built X...\nImproved Y...\nShipped Z..."></textarea>
              </div>
            </div>

            <hr style="border:none;border-top:1px solid var(--line);margin:12px 0">

            <div class="row">
              <div>
                <label>Role (2)</label>
                <input id="exp_role_2" placeholder="e.g. Production / Ops" />
              </div>
              <div>
                <label>Company (2)</label>
                <input id="exp_company_2" placeholder="e.g. Previous Company" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Dates (2)</label>
                <input id="exp_dates_2" placeholder="e.g. 2023 ‚Äì 2025" />
              </div>
              <div>
                <label>Location (2)</label>
                <input id="exp_loc_2" placeholder="e.g. City / Remote" />
              </div>
            </div>
            <div class="row one">
              <div>
                <label>Highlights (2) ‚Äî one per line</label>
                <textarea id="exp_points_2"></textarea>
              </div>
            </div>

            <details style="margin-top:12px">
              <summary style="cursor:pointer;color:var(--muted);font-size:12px">Add more experience (3 & 4)</summary>
              <div style="margin-top:10px">

                <hr style="border:none;border-top:1px solid var(--line);margin:12px 0">

                <div class="row">
                  <div>
                    <label>Role (3)</label>
                    <input id="exp_role_3" />
                  </div>
                  <div>
                    <label>Company (3)</label>
                    <input id="exp_company_3" />
                  </div>
                </div>
                <div class="row">
                  <div>
                    <label>Dates (3)</label>
                    <input id="exp_dates_3" />
                  </div>
                  <div>
                    <label>Location (3)</label>
                    <input id="exp_loc_3" />
                  </div>
                </div>
                <div class="row one">
                  <div>
                    <label>Highlights (3)</label>
                    <textarea id="exp_points_3"></textarea>
                  </div>
                </div>

                <hr style="border:none;border-top:1px solid var(--line);margin:12px 0">

                <div class="row">
                  <div>
                    <label>Role (4)</label>
                    <input id="exp_role_4" />
                  </div>
                  <div>
                    <label>Company (4)</label>
                    <input id="exp_company_4" />
                  </div>
                </div>
                <div class="row">
                  <div>
                    <label>Dates (4)</label>
                    <input id="exp_dates_4" />
                  </div>
                  <div>
                    <label>Location (4)</label>
                    <input id="exp_loc_4" />
                  </div>
                </div>
                <div class="row one">
                  <div>
                    <label>Highlights (4)</label>
                    <textarea id="exp_points_4"></textarea>
                  </div>
                </div>

              </div>
            </details>
          </div>

          <div class="section">
            <div class="section-title">
              <b>Education</b>
              <span class="pill">Optional</span>
            </div>
            <div class="row">
              <div>
                <label>Qualification</label>
                <input id="edu_title" placeholder="e.g. Diploma in IT" />
              </div>
              <div>
                <label>Institution</label>
                <input id="edu_school" placeholder="e.g. College / University" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Dates</label>
                <input id="edu_dates" placeholder="e.g. 2021 ‚Äì 2023" />
              </div>
              <div>
                <label>Notes</label>
                <input id="edu_notes" placeholder="e.g. Relevant modules / awards" />
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-title">
              <b>Projects</b>
              <span class="pill">One per line</span>
            </div>
            <div class="row one">
              <div>
                <label>Projects (name ‚Äî short result)</label>
                <textarea id="projects" placeholder="Project Name ‚Äî what it does + result\nProject Name ‚Äî stack used + impact\nProject Name ‚Äî measurable outcome"></textarea>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-title">
              <b>Extras</b>
              <span class="pill">Optional</span>
            </div>
            <div class="row one">
              <div>
                <label>Certifications / Languages / Links (one per line)</label>
                <textarea id="extras" placeholder="GitHub: github.com/...\nLinkedIn: linkedin.com/in/...\nDriver‚Äôs license: ..."></textarea>
              </div>
            </div>
            <div class="hint">When exporting, choose A4 and enable ‚ÄúBackground graphics‚Äù for best look.</div>
          </div>

          <div class="section">
            <div class="section-title">
              <b>Suggestions & Improvements</b>
              <span class="pill" id="qualityLevel">Draft</span>
            </div>
            <div class="scoreCard">
              <div class="scoreHead">
                <b>CV quality score</b>
                <span id="qualityScore">0 / 100</span>
              </div>
              <div class="scoreTrack" aria-hidden="true">
                <div class="scoreFill" id="qualityFill"></div>
              </div>
            </div>
            <ul class="suggestions" id="improvementList"></ul>
            <div class="hint">Tip: Strong CVs are specific, measurable, and keyword-rich for ATS scans.</div>
          </div>

        </div>
      </div>

      <!-- RIGHT: PREVIEW -->
      <div class="panel right">
        <div class="hd">
          <strong>Preview</strong>
          <div class="split">
            <span class="pill">Print-ready</span>
          </div>
        </div>
        <div class="previewWrap">
          <div class="cv" id="cv">
            <div class="cvInner">
              <div class="cvTop">
                <div>
                  <h2 class="name" id="p_name">Your Name</h2>
                  <div class="role" id="p_headline">Your Role / Headline</div>
                </div>
                <div class="contact" id="p_contact">
                  Phone ‚Ä¢ Email ‚Ä¢ Website ‚Ä¢ Location
                </div>
              </div>

              <div class="twoCol">
                <div>
                  <h3>Summary</h3>
                  <div class="summary" id="p_summary">Write a short professional summary.</div>

                  <h3>Experience</h3>
                  <div id="p_experience"></div>

                  <h3>Projects</h3>
                  <div class="smallText" id="p_projects"></div>
                </div>

                <div>
                  <div class="smallBox">
                    <h3>Skills</h3>
                    <div class="tagList" id="p_skills"></div>
                  </div>

                  <div class="smallBox">
                    <h3>Education</h3>
                    <div class="smallText" id="p_education"></div>
                  </div>

                  <div class="smallBox">
                    <h3>Extras</h3>
                    <div class="smallText" id="p_extras"></div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="hint">
            Want it to auto-fill with your info? Tell me your details and I‚Äôll paste a pre-filled version.
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const ids = [
      "fullName","headline","phone","email","website","location","summary","skills",
      "exp_role_1","exp_company_1","exp_dates_1","exp_loc_1","exp_points_1",
      "exp_role_2","exp_company_2","exp_dates_2","exp_loc_2","exp_points_2",
      "exp_role_3","exp_company_3","exp_dates_3","exp_loc_3","exp_points_3",
      "exp_role_4","exp_company_4","exp_dates_4","exp_loc_4","exp_points_4",
      "edu_title","edu_school","edu_dates","edu_notes",
      "projects","extras"
    ];

    const $ = (id) => document.getElementById(id);

    function safe(v){ return (v ?? "").toString().trim(); }

    function linesToBullets(txt){
      const raw = safe(txt);
      if(!raw) return [];
      return raw
        .split("\n")
        .map(s => s.replace(/^\s*[-‚Ä¢]\s*/, "").trim())
        .filter(Boolean);
    }

    function commaToTags(txt){
      const raw = safe(txt);
      if(!raw) return [];
      return raw
        .split(/[,\n]/)
        .map(s => s.trim())
        .filter(Boolean);
    }

    function buildContact(){
      const phone = safe($("phone").value);
      const email = safe($("email").value);
      const website = safe($("website").value);
      const location = safe($("location").value);

      const parts = [];
      if(phone) parts.push(phone);

      if(email){
        const e = email;
        parts.push(`<a href="mailto:${escapeHtmlAttr(e)}">${escapeHtml(e)}</a>`);
      }
      if(website){
        const w = website.replace(/^https?:\/\//i,"");
        const href = website.match(/^https?:\/\//i) ? website : ("https://" + w);
        parts.push(`<a href="${escapeHtmlAttr(href)}" target="_blank" rel="noopener">${escapeHtml(w)}</a>`);
      }
      if(location) parts.push(escapeHtml(location));

      return parts.length ? parts.join("<br>") : "Phone ‚Ä¢ Email ‚Ä¢ Website ‚Ä¢ Location";
    }

    function buildExperience(){
      const wrap = document.createElement("div");

      for(let i=1;i<=4;i++){
        const role = safe($(`exp_role_${i}`).value);
        const company = safe($(`exp_company_${i}`).value);
        const dates = safe($(`exp_dates_${i}`).value);
        const loc = safe($(`exp_loc_${i}`).value);
        const points = linesToBullets($(`exp_points_${i}`).value);

        if(!role && !company && !dates && !loc && points.length===0) continue;

        const item = document.createElement("div");
        item.className = "item";

        const title = escapeHtml([role, company].filter(Boolean).join(" ‚Äî ") || "Experience");
        const meta = escapeHtml([dates, loc].filter(Boolean).join(" ‚Ä¢ "));

        item.innerHTML = `
          <div class="itemTop">
            <div class="itemTitle">${title}</div>
            <div class="itemMeta">${meta}</div>
          </div>
          ${company && role ? `<div class="itemSub">${escapeHtml(company)}</div>` : ``}
        `;

        if(points.length){
          const ul = document.createElement("ul");
          ul.className = "bullets";
          for(const p of points){
            const li = document.createElement("li");
            li.textContent = p;
            ul.appendChild(li);
          }
          item.appendChild(ul);
        }

        wrap.appendChild(item);
      }

      if(!wrap.children.length){
        const empty = document.createElement("div");
        empty.className = "smallText";
        empty.textContent = "Add your work experience on the left.";
        wrap.appendChild(empty);
      }
      return wrap;
    }

    function buildProjects(){
      const rows = linesToBullets($("projects").value);
      if(!rows.length) return "Add 2‚Äì5 projects that show proof of work.";
      return rows.map(r => "‚Ä¢ " + r).join("\n");
    }

    function buildEducation(){
      const t = safe($("edu_title").value);
      const s = safe($("edu_school").value);
      const d = safe($("edu_dates").value);
      const n = safe($("edu_notes").value);

      const parts = [];
      const top = [t, s].filter(Boolean).join(" ‚Äî ");
      if(top) parts.push(top);
      const meta = [d, n].filter(Boolean).join(" ‚Ä¢ ");
      if(meta) parts.push(meta);

      return parts.length ? parts.join("\n") : "Optional ‚Äî add your highest qualification.";
    }

    function buildExtras(){
      const rows = linesToBullets($("extras").value);
      if(!rows.length) return "Optional ‚Äî certifications, links, languages, etc.";
      return rows.map(r => "‚Ä¢ " + r).join("\n");
    }

    function getQualityAssessment(){
      let score = 0;
      const suggestions = [];

      const fullName = safe($("fullName").value);
      const headline = safe($("headline").value);
      const phone = safe($("phone").value);
      const email = safe($("email").value);
      const website = safe($("website").value);
      const location = safe($("location").value);
      const summary = safe($("summary").value);
      const skills = commaToTags($("skills").value);
      const projects = linesToBullets($("projects").value);

      if(fullName) score += 8; else suggestions.push("Add your full name so recruiters can identify your CV immediately.");
      if(headline) score += 8; else suggestions.push("Add a role headline (e.g. Frontend Developer, Data Analyst).");

      const emailLooksValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if(phone) score += 5; else suggestions.push("Add a phone number in international format.");
      if(emailLooksValid) score += 7; else suggestions.push("Use a professional, valid email address.");
      if(website) score += 5; else suggestions.push("Add a portfolio, GitHub, or LinkedIn link.");
      if(location) score += 3;

      const summaryWords = summary ? summary.split(/\s+/).filter(Boolean).length : 0;
      if(summaryWords >= 35 && summaryWords <= 120){
        score += 14;
      } else if(summaryWords > 0){
        score += 6;
        suggestions.push("Keep summary between 35 and 120 words with clear strengths and target role.");
      } else {
        suggestions.push("Write a focused summary: strengths, tools, and outcomes.");
      }

      if(skills.length >= 8){
        score += 12;
      } else if(skills.length >= 4){
        score += 7;
        suggestions.push("Add 4-8 more role-specific skills to improve ATS matching.");
      } else {
        suggestions.push("List at least 8 skills (technical + domain + tools).");
      }

      let expCount = 0;
      let expBulletCount = 0;
      let quantifiedCount = 0;
      for(let i=1;i<=4;i++){
        const role = safe($(`exp_role_${i}`).value);
        const company = safe($(`exp_company_${i}`).value);
        const dates = safe($(`exp_dates_${i}`).value);
        const points = linesToBullets($(`exp_points_${i}`).value);
        if(role || company || dates || points.length){
          expCount++;
          expBulletCount += points.length;
          quantifiedCount += points.filter(p => /(\d+|%|\$|kpi|reduced|increased|improved|cut|grew)/i.test(p)).length;
        }
      }

      if(expCount >= 2){
        score += 12;
      } else if(expCount === 1){
        score += 6;
        suggestions.push("Add at least one more experience entry for stronger credibility.");
      } else {
        suggestions.push("Add experience entries with role, company, dates, and highlights.");
      }

      if(expBulletCount >= 6){
        score += 8;
      } else if(expBulletCount > 0){
        score += 4;
        suggestions.push("Add more impact bullets (aim for 2-4 bullets per role).");
      } else {
        suggestions.push("Add achievement bullets under each role.");
      }

      if(quantifiedCount >= 3){
        score += 10;
      } else {
        suggestions.push("Add measurable results to bullets (numbers, %, time saved, revenue, users).");
      }

      if(projects.length >= 2){
        score += 8;
      } else if(projects.length === 1){
        score += 4;
        suggestions.push("Add one more project with a clear result.");
      } else {
        suggestions.push("Add 2-5 projects with technologies and outcomes.");
      }

      const edu = [safe($("edu_title").value), safe($("edu_school").value)].filter(Boolean).length;
      if(edu > 0) score += 4;

      const extras = linesToBullets($("extras").value).length;
      if(extras > 0) score += 4;

      score = Math.max(0, Math.min(100, score));
      const level = score >= 80 ? "Strong" : (score >= 60 ? "Good" : (score >= 40 ? "Developing" : "Draft"));
      return { score, level, suggestions: suggestions.slice(0, 6) };
    }

    function renderQuality(){
      const scoreEl = $("qualityScore");
      const fillEl = $("qualityFill");
      const levelEl = $("qualityLevel");
      const listEl = $("improvementList");
      if(!scoreEl || !fillEl || !levelEl || !listEl) return;

      const result = getQualityAssessment();
      scoreEl.textContent = `${result.score} / 100`;
      fillEl.style.width = `${result.score}%`;
      levelEl.textContent = result.level;

      listEl.innerHTML = "";
      if(!result.suggestions.length){
        const li = document.createElement("li");
        li.textContent = "Great base CV. Tailor keywords to each job description before exporting.";
        listEl.appendChild(li);
        return;
      }
      for(const msg of result.suggestions){
        const li = document.createElement("li");
        li.textContent = msg;
        listEl.appendChild(li);
      }
    }

    function render(){
      $("p_name").textContent = safe($("fullName").value) || "Your Name";
      $("p_headline").textContent = safe($("headline").value) || "Your Role / Headline";
      $("p_contact").innerHTML = buildContact();

      $("p_summary").textContent = safe($("summary").value) || "Write a short professional summary.";

      // Skills tags
      const skills = commaToTags($("skills").value);
      const skillWrap = $("p_skills");
      skillWrap.innerHTML = "";
      if(skills.length){
        for(const s of skills){
          const el = document.createElement("span");
          el.className = "tag";
          el.textContent = s;
          skillWrap.appendChild(el);
        }
      } else {
        const el = document.createElement("span");
        el.className = "tag";
        el.textContent = "Add skills (comma separated)";
        skillWrap.appendChild(el);
      }

      // Experience
      const exp = buildExperience();
      const expWrap = $("p_experience");
      expWrap.innerHTML = "";
      expWrap.appendChild(exp);

      // Projects / Education / Extras
      $("p_projects").textContent = buildProjects();
      $("p_education").textContent = buildEducation();
      $("p_extras").textContent = buildExtras();
      renderQuality();
    }

    function getState(){
      const state = { version: 1, data: {} };
      for(const id of ids) state.data[id] = $(id).value ?? "";
      return state;
    }

    function setState(state){
      if(!state || !state.data) return;
      for(const id of ids){
        if(Object.prototype.hasOwnProperty.call(state.data, id)){
          $(id).value = state.data[id];
        }
      }
      render();
    }

    function download(filename, text){
      const blob = new Blob([text], {type:"application/json;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#39;");
    }
    function escapeHtmlAttr(str){ return escapeHtml(str).replaceAll("`","&#96;"); }

    // Wire up events
    for(const id of ids){
      $(id).addEventListener("input", render);
    }

    $("btnPrint").addEventListener("click", () => {
      // Make sure preview is up to date before printing
      render();
      window.print();
    });

    $("btnSave").addEventListener("click", () => {
      const state = getState();
      const name = safe($("fullName").value).replace(/\s+/g," ").trim() || "cv";
      const stamp = new Date().toISOString().slice(0,10);
      download(`${name.toLowerCase().replace(/[^a-z0-9]+/g,"-")}-cv-${stamp}.json`, JSON.stringify(state, null, 2));
    });

    $("fileLoad").addEventListener("change", async (e) => {
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      try{
        const text = await file.text();
        const json = JSON.parse(text);
        setState(json);
      } catch(err){
        alert("Invalid JSON file.");
      } finally{
        e.target.value = "";
      }
    });

    $("btnReset").addEventListener("click", () => {
      if(!confirm("Reset all fields?")) return;
      for(const id of ids) $(id).value = "";
      try{ localStorage.removeItem(KEY); } catch {}
      render();
    });

    // First render
    render();

    // (Optional) Lightweight autosave to localStorage
    const KEY = "cvgen_state_v1";
    function autosave(){
      try{ localStorage.setItem(KEY, JSON.stringify(getState())); } catch {}
    }
    function autoload(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return;
        const st = JSON.parse(raw);
        setState(st);
      } catch {}
    }
    // enable autosave
    for(const id of ids) $(id).addEventListener("input", autosave);
    autoload();
  </script>
</body>
</html>
